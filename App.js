import React, { useState, useLayoutEffect } from "react";
import { AppLoading } from "expo";
import * as Font from "expo-font";
import { Asset } from "expo-asset";
import { AppNavigator } from "./routes/AppNavigator";
import firebase from "./firebase/config";
import { library } from "@fortawesome/fontawesome-svg-core";
import {
    faLowVision,
    faBell,
    faRadiation,
    faSkullCrossbones,
    faCat,
    faCrow,
    faDog,
    faDove,
    faDragon,
    faFeatherAlt,
    faFish,
    faFrog,
    faHippo,
    faHorse,
    faHorseHead,
    faKiwiBird,
    faOtter,
    faPaw,
    faSpider,
    faArrowsAlt,
    faCaretSquareRight,
    faCompressAlt,
    faExchangeAlt,
    faExternalLinkAlt,
    faHandPointUp,
    faRecycle,
    faRandom,
    faMousePointer,
    faRetweet,
    faSortAmountUp,
    faCompress,
    faExpand,
    faForward,
    faMusic,
    faPauseCircle,
    faVideo,
    faTv,
    faAirFreshener,
    faAmbulance,
    faBus,
    faCar,
    faCarBattery,
    faCarSide,
    faOilCan,
    faGasPump,
    faMotorcycle,
    faShuttleVan,
    faAppleAlt,
    faCampground,
    faCloudSun,
    faDrumstickBite,
    faFootballBall,
    faHiking,
    faMountain,
    faTractor,
    faTree,
    faWind,
    faWineBottle,
    faBeer,
    faCocktail,
    faCoffee,
    faFlask,
    faBlender,
    faGlassCheers,
    faGlassWhiskey,
    faWineGlassAlt,
    faBuilding,
    faArchway,
    faChurch,
    faCity,
    faClinicMedical,
    faGopuram,
    faHome,
    faHospitalAlt,
    faIgloo,
    faKaaba,
    faLandmark,
    faMonument,
    faMosque,
    faSchool,
    faStore,
    faToriiGate,
    faVihara,
    faWarehouse,
    faAddressCard,
    faBalanceScale,
    faBirthdayCake,
    faBook,
    faBriefcase,
    faBullhorn,
    faBullseye,
    faCalculator,
    faCalendarAlt,
    faCertificate,
    faChartPie,
    faClipboard,
    faCompass,
    faCut,
    faEnvelope,
    faEraser,
    faFile,
    faFolder,
    faGlasses,
    faGlobe,
    faHighlighter,
    faPen,
    faMarker,
    faPaperclip,
    faPenFancy,
    faPencilAlt,
    faPercent,
    faPhone,
    faProjectDiagram,
    faSave,
    faSitemap,
    faSocks,
    faStream,
    faTag,
    faThumbtack,
    faWallet,
    faBinoculars,
    faFaucet,
    faFire,
    faFireAlt,
    faFirstAid,
    faMap,
    faMapSigns,
    faRoute,
    faToiletPaper,
    faTrailer,
    faDollarSign,
    faGift,
    faHandHoldingHeart,
    faHandHoldingMedical,
    faHandHoldingWater,
    faHandsHelping,
    faHandshake,
    faHeart,
    faLeaf,
    faParachuteBox,
    faPiggyBank,
    faRibbon,
    faSeedling,
    faComment,
    faCommentAlt,
    faFrown,
    faSmile,
    faMeh,
    faPoo,
    faQuoteLeft,
    faQuoteRight,
    faChessBishop,
    faChessPawn,
    faChessQueen,
    faChessRook,
    faBaby,
    faBabyCarriage,
    faBiking,
    faCookieBite,
    faGamepad,
    faIceCream,
    faMitten,
    faRobot,
    faShapes,
    faSnowman,
    faGraduationCap,
    faHatCowboy,
    faHatCowboySide,
    faHatWizard,
    faShoePrints,
    faTshirt,
    faUserTie,
    faBath,
    faBug,
    faFilter,
    faFireExtinguisher,
    faKeyboard,
    faShieldAlt,
    faMobile,
    faPaperPlane,
    faCompactDisc,
    faDatabase,
    faHdd,
    faHeadphones,
    faLaptop,
    faMouse,
    faPlug,
    faPowerOff,
    faSatellite,
    faSatelliteDish,
    faSimCard,
    faBrush,
    faDraftingCompass,
    faDumpster,
    faHammer,
    faHardHat,
    faPaintRoller,
    faRuler,
    faPencilRuler,
    faRulerCombined,
    faScrewdriver,
    faToolbox,
    faTools,
    faWrench,
    faMoneyBill,
    faClock,
    faHourglass,
    faStopwatch,
    faAdjust,
    faBezierCurve,
    fabrush,
    faCropAlt,
    faCrosshairs,
    faDrawPolygon,
    faEye,
    faEyeDropper,
    faLayerGroup,
    faMagic,
    faPaintBrush,
    faPalette,
    faSplotch,
    faSprayCan,
    faStamp,
    faSwatchbook,
    faVectorSquare,
    faAlignLeft,
    faBorderAll,
    faBorderStyle,
    faLink,
    faTrash,
    faAtom,
    faAward,
    faBookOpen,
    faChalkboard,
    faMicroscope,
    faTheaterMasks,
    faUserGraduate,
    faFlushed,
    faGrinBeam,
    faGrinStars,
    faGrinTongueWink,
    faMehBlank,
    faBatteryHalf,
    faBurn,
    faFan,
    faLightbulb,
    faSolarPanel,
    faSun,
    faWater,
    faCashRegister,
    faCoins,
    faCreditCard,
    faReceipt,
    faBicycle,
    faHeartbeat,
    faRunning,
    faSkating,
    faSkiing,
    faSkiingNordic,
    faSnowboarding,
    faSpa,
    faSwimmer,
    faWalking,
    faBacon,
    faBone,
    faBreadSlice,
    faCandyCane,
    faCarrot,
    faCheese,
    faCloudMeatball,
    faEgg,
    faHamburger,
    faHotdog,
    faLemon,
    faPepperHot,
    faPizzaSlice,
    faStroopwafel,
    faDiceThree,
    faDiceFive,
    faDiceSix,
    faGhost,
    faPuzzlePiece,
    faBroom,
    faCloudMoon,
    faMask,
    faHandLizard,
    faHandPaper,
    faThumbsUp,
    faUserMd,
    faHollyBerry,
    faSleigh,
    faConciergeBell,
    faDoorClosed,
    faDumbbell,
    faHotTub,
    faInfinity,
    faKey,
    faShower,
    faSmoking,
    faSnowflake,
    faSwimmingPool,
    faUmbrellaBeach,
    faUtensils,
    faBed,
    faChair,
    faCouch,
    faDungeon,
    faSoap,
    faCamera,
    faCameraRetro,
    faSlidersH,
    faCheck,
    faCircle,
    faCloud,
    faDotCircle,
    faEllipsisH,
    faFingerprint,
    faFlag,
    faFlagCheckered,
    faGripLines,
    faGripVertical,
    faICursor,
    faMedal,
    faPlus,
    faStar,
    faSync,
    faTrophy,
    faUserCircle,
    faBox,
    faBoxes,
    faDolly,
    faAnchor,
    faBomb,
    faBookmark,
    faFighterJet,
    faGavel,
    faHelicopter,
    faLifeRing,
    faMapPin,
    faPlane,
    faRoad,
    faRocket,
    faSearch,
    faShip,
    faShoppingBag,
    faShoppingBasket,
    faShoppingCart,
    faSnowplow,
    faSubway,
    faTicketAlt,
    faTrafficLight,
    faTram,
    faUmbrella,
    faUtensilSpoon,
    faVest,
    faDharmachakra,
    faWaveSquare,
    faBacterium,
    faBandAid,
    faBrain,
    faCapsules,
    faCrutch,
    faDisease,
    faDna,
    faHeadSideMask,
    faMortarPestle,
    faLungs,
    faPager,
    faSyringe,
    faStarOfLife,
    faTeeth,
    faTooth,
    faVial,
    faXRay,
    faPeopleCarry,
    faSign,
    faTape,
    faDrum,
    faDrumSteelpan,
    faGuitar,
    faMicrophone,
    faRecordVinyl,
    faCog,
    faCubes,
    faCube,
    faDiceD20,
    faFutbol,
    faGem,
    faMagnet,
    faScroll,
    faSpaceShuttle,
    faTachometerAlt,
    faToilet,
    faUnlock,
    faTablets,
    faPeace,
    faMoon,
    faMeteor,
    faUserAstronaut,
    faSquare,
    faUserFriends,
    faRing,
    faSpinner,
    faYinYang,
    faBaseballBall,
    faBasketballBall,
    faBowlingBall,
    faGolfBall,
    faHockeyPuck,
    faTableTennis,
    faVolleyballBall,
    faRainbow,
    faCloudSunRain,
    faSignal,
    faGlobeAmericas,
    faPlaneArrival,
    faPlaneDeparture,
    faUserNinja,
    faBolt,
    faPooStorm,
    faIcicles,
} from "@fortawesome/free-solid-svg-icons";
import { render } from "react-dom";

function cacheImages(images) {
    return images.map((image) => {
        if (typeof image === "string") {
            return Image.prefetch(image);
        } else {
            return Asset.fromModule(image).downloadAsync();
        }
    });
}

function cacheFonts(fonts) {
    return fonts.map((font) => Font.loadAsync(font));
}

export default function App() {
    const [user, setUser] = useState(null);
    const [noUser, setNoUser] = useState(false);
    const [appIsReady, setAppIsReady] = useState(false);

    library.add(
        faLowVision,
        faBell,
        faRadiation,
        faSkullCrossbones,
        faCat,
        faCrow,
        faDog,
        faDove,
        faDragon,
        faFeatherAlt,
        faFish,
        faFrog,
        faHippo,
        faHorse,
        faHorseHead,
        faKiwiBird,
        faOtter,
        faPaw,
        faSpider,
        faArrowsAlt,
        faCaretSquareRight,
        faCompressAlt,
        faExchangeAlt,
        faExternalLinkAlt,
        faHandPointUp,
        faRecycle,
        faRandom,
        faMousePointer,
        faRetweet,
        faSortAmountUp,
        faCompress,
        faExpand,
        faForward,
        faMusic,
        faPauseCircle,
        faVideo,
        faTv,
        faAirFreshener,
        faAmbulance,
        faBus,
        faCar,
        faCarBattery,
        faCarSide,
        faOilCan,
        faGasPump,
        faMotorcycle,
        faShuttleVan,
        faAppleAlt,
        faCampground,
        faCloudSun,
        faDrumstickBite,
        faFootballBall,
        faHiking,
        faMountain,
        faTractor,
        faTree,
        faWind,
        faWineBottle,
        faBeer,
        faCocktail,
        faCoffee,
        faFlask,
        faBlender,
        faGlassCheers,
        faGlassWhiskey,
        faWineGlassAlt,
        faBuilding,
        faArchway,
        faChurch,
        faCity,
        faClinicMedical,
        faGopuram,
        faHome,
        faHospitalAlt,
        faIgloo,
        faKaaba,
        faLandmark,
        faMonument,
        faMosque,
        faSchool,
        faStore,
        faToriiGate,
        faVihara,
        faWarehouse,
        faAddressCard,
        faBalanceScale,
        faBirthdayCake,
        faBook,
        faBriefcase,
        faBullhorn,
        faBullseye,
        faCalculator,
        faCalendarAlt,
        faCertificate,
        faChartPie,
        faClipboard,
        faCompass,
        faCut,
        faEnvelope,
        faEraser,
        faFile,
        faFolder,
        faGlasses,
        faGlobe,
        faHighlighter,
        faPen,
        faMarker,
        faPaperclip,
        faPenFancy,
        faPencilAlt,
        faPercent,
        faPhone,
        faProjectDiagram,
        faSave,
        faSitemap,
        faSocks,
        faStream,
        faTag,
        faThumbtack,
        faWallet,
        faBinoculars,
        faFaucet,
        faFire,
        faFireAlt,
        faFirstAid,
        faMap,
        faMapSigns,
        faRoute,
        faToiletPaper,
        faTrailer,
        faDollarSign,
        faGift,
        faHandHoldingHeart,
        faHandHoldingMedical,
        faHandHoldingWater,
        faHandsHelping,
        faHandshake,
        faHeart,
        faLeaf,
        faParachuteBox,
        faPiggyBank,
        faRibbon,
        faSeedling,
        faComment,
        faCommentAlt,
        faFrown,
        faSmile,
        faMeh,
        faPoo,
        faQuoteLeft,
        faQuoteRight,
        faChessBishop,
        faChessPawn,
        faChessQueen,
        faChessRook,
        faBaby,
        faBabyCarriage,
        faBiking,
        faCookieBite,
        faGamepad,
        faIceCream,
        faMitten,
        faRobot,
        faShapes,
        faSnowman,
        faGraduationCap,
        faHatCowboy,
        faHatCowboySide,
        faHatWizard,
        faShoePrints,
        faTshirt,
        faUserTie,
        faBath,
        faBug,
        faFilter,
        faFireExtinguisher,
        faKeyboard,
        faShieldAlt,
        faMobile,
        faPaperPlane,
        faCompactDisc,
        faDatabase,
        faHdd,
        faHeadphones,
        faLaptop,
        faMouse,
        faPlug,
        faPowerOff,
        faSatellite,
        faSatelliteDish,
        faSimCard,
        faBrush,
        faDraftingCompass,
        faDumpster,
        faHammer,
        faHardHat,
        faPaintRoller,
        faRuler,
        faPencilRuler,
        faRulerCombined,
        faScrewdriver,
        faToolbox,
        faTools,
        faWrench,
        faMoneyBill,
        faClock,
        faHourglass,
        faStopwatch,
        faAdjust,
        faBezierCurve,
        faBrush,
        faCropAlt,
        faCrosshairs,
        faDrawPolygon,
        faEye,
        faEyeDropper,
        faLayerGroup,
        faMagic,
        faPaintBrush,
        faPalette,
        faSplotch,
        faSprayCan,
        faStamp,
        faSwatchbook,
        faVectorSquare,
        faAlignLeft,
        faBorderAll,
        faBorderStyle,
        faLink,
        faTrash,
        faAtom,
        faAward,
        faBookOpen,
        faChalkboard,
        faMicroscope,
        faTheaterMasks,
        faUserGraduate,
        faFlushed,
        faGrinBeam,
        faGrinStars,
        faGrinTongueWink,
        faMehBlank,
        faBatteryHalf,
        faBurn,
        faFan,
        faLightbulb,
        faSolarPanel,
        faSun,
        faWater,
        faCashRegister,
        faCoins,
        faCreditCard,
        faReceipt,
        faBicycle,
        faHeartbeat,
        faRunning,
        faSkating,
        faSkiing,
        faSkiingNordic,
        faSnowboarding,
        faSpa,
        faSwimmer,
        faWalking,
        faBacon,
        faBone,
        faBreadSlice,
        faCandyCane,
        faCarrot,
        faCheese,
        faCloudMeatball,
        faEgg,
        faHamburger,
        faHotdog,
        faLemon,
        faPepperHot,
        faPizzaSlice,
        faStroopwafel,
        faDiceThree,
        faDiceFive,
        faDiceSix,
        faGhost,
        faPuzzlePiece,
        faBroom,
        faCloudMoon,
        faMask,
        faHandLizard,
        faHandPaper,
        faThumbsUp,
        faUserMd,
        faHollyBerry,
        faSleigh,
        faConciergeBell,
        faDoorClosed,
        faDumbbell,
        faHotTub,
        faInfinity,
        faKey,
        faShower,
        faSmoking,
        faSnowflake,
        faSwimmingPool,
        faUmbrellaBeach,
        faUtensils,
        faBed,
        faChair,
        faCouch,
        faDungeon,
        faSoap,
        faCamera,
        faCameraRetro,
        faSlidersH,
        faCheck,
        faCircle,
        faCloud,
        faDotCircle,
        faEllipsisH,
        faFingerprint,
        faFlag,
        faFlagCheckered,
        faGripLines,
        faGripVertical,
        faICursor,
        faMedal,
        faPlus,
        faStar,
        faSync,
        faTrophy,
        faUserCircle,
        faBox,
        faBoxes,
        faDolly,
        faAnchor,
        faBomb,
        faBookmark,
        faFighterJet,
        faGavel,
        faHelicopter,
        faLifeRing,
        faMapPin,
        faPlane,
        faRoad,
        faRocket,
        faSearch,
        faShip,
        faShoppingBag,
        faShoppingBasket,
        faShoppingCart,
        faSnowplow,
        faSubway,
        faTicketAlt,
        faTrafficLight,
        faTram,
        faUmbrella,
        faUtensilSpoon,
        faVest,
        faDharmachakra,
        faWaveSquare,
        faBacterium,
        faBandAid,
        faBrain,
        faCapsules,
        faCrutch,
        faDisease,
        faDna,
        faHeadSideMask,
        faMortarPestle,
        faLungs,
        faPager,
        faSyringe,
        faStarOfLife,
        faTeeth,
        faTooth,
        faVial,
        faXRay,
        faPeopleCarry,
        faSign,
        faTape,
        faDrum,
        faDrumSteelpan,
        faGuitar,
        faMicrophone,
        faRecordVinyl,
        faCog,
        faCubes,
        faCube,
        faDiceD20,
        faFutbol,
        faGem,
        faMagnet,
        faScroll,
        faSpaceShuttle,
        faTachometerAlt,
        faToilet,
        faUnlock,
        faTablets,
        faPeace,
        faMoon,
        faMeteor,
        faUserAstronaut,
        faSquare,
        faUserFriends,
        faRing,
        faSpinner,
        faYinYang,
        faBaseballBall,
        faBasketballBall,
        faBowlingBall,
        faGolfBall,
        faHockeyPuck,
        faTableTennis,
        faVolleyballBall,
        faRainbow,
        faCloudSunRain,
        faSignal,
        faGlobeAmericas,
        faPlaneArrival,
        faPlaneDeparture,
        faUserNinja,
        faBolt,
        faPooStorm,
        faIcicles
    );

    const firebaseAsync = () => {
        const usersRef = firebase.firestore().collection("users");
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                usersRef
                    .doc(user.uid)
                    .get()
                    .then((document) => {
                        const userData = document.data();
                        setUser(userData);
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            } else {
                setNoUser(true);
            }
        });
        return "done";
    };

    const _loadAssetsAsync = async () => {
        const firebaseData = await firebaseAsync();
        const imageAssets = cacheImages([
            require("./assets/images/bg2X.png"),
            require("./assets/images/bannerBlue.png"),
            require("./assets/images/doodle3c.jpg"),
            require("./assets/images/trophyTeal.jpg"),
            require("./assets/images/confetti.gif"),
        ]);

        const fontAssets = cacheFonts([
            { "nunito-regular": require("./assets/fonts/Nunito-Regular.ttf") },
            { "nunito-bold": require("./assets/fonts/Nunito-Bold.ttf") },
            { "nunito-light": require("./assets/fonts/Nunito-Light.ttf") },
        ]);

        await Promise.all([...imageAssets, ...fontAssets]);
    };

    const _handleLoadingError = (error) => {
        // In this case, you might want to report the error to your error
        // reporting service, for example Sentry
        console.warn(error);
    };

    const _handleFinishLoading = () => {
        setAppIsReady(true);
    };

    // useLayoutEffect(() => {
    //     firebaseAsync();
    // }, []);

    // let [fontsLoaded] = useFonts({
    //     "nunito-regular": require("./assets/fonts/Nunito-Regular.ttf"),
    //     "nunito-bold": require("./assets/fonts/Nunito-Bold.ttf"),
    //     "nunito-light": require("./assets/fonts/Nunito-Light.ttf"),
    // });

    // if (fontsLoaded && (user || noUser)) {
    //     return (
    //         <AppNavigator
    //             userData={user}
    //             mainDeck={Object.keys(library.definitions.fas)}
    //         />
    //     );
    // } else {
    //     return <AppLoading />;
    // }

    if (appIsReady && (user || noUser)) {
        return (
            <AppNavigator
                userData={user}
                mainDeck={Object.keys(library.definitions.fas)}
            />
        );
    } else {
        return (
            <AppLoading
                startAsync={_loadAssetsAsync}
                onError={_handleLoadingError}
                onFinish={_handleFinishLoading}
            />
        );
    }
}
